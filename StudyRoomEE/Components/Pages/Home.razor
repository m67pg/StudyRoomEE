@page "/"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider

<div class="mobile-container">
    <AuthorizeView>
        <Authorized>
            @* --- 共通：ログアウトとメッセージ --- *@
            <div class="d-flex align-items-center justify-content-end my-1">
                <form action="logout" method="post" class="m-0 d-inline">
                    <AntiforgeryToken />
                    <button type="submit" class="btn btn-link p-0 text-decoration-none border-0" title="ログアウト"
                            style="color: #d63638; line-height: 1; background: none;">
                        <i class="bi bi-box-arrow-right fs-5 me-1"></i>
                    </button>
                    <span class="ms-2" style="font-size: 0.85rem; color: #333;">
                        こんにちは、<strong>@context.User.Identity?.Name</strong> さん
                    </span>
                </form>
            </div>

            @* --- 権限による出し分け --- *@
            @{
                // ClaimからStudentIdを取得（数値変換）
                var sIdClaim = context.User.FindFirst("StudentId")?.Value;
                int.TryParse(sIdClaim, out int sId);
            }

            <AttendancePanel StudentId="sId" AuthStateProvider="AuthStateProvider" />
        </Authorized>
    </AuthorizeView>
</div>

<style>
    .mobile-container { max-width: 500px; margin: 0 auto; padding: 20px; font-family: sans-serif; }
</style>